language: android
jdk: oraclejdk8
sudo: false

env:
  global:
  - ANDROID_API_LEVEL=28
  - ANDROID_BUILD_TOOLS_VERSION=28.0.3

android:
  components:
  - tools
  - platform-tools
  - android-$ANDROID_API_LEVEL
  - build-tools-$ANDROID_BUILD_TOOLS_VERSION

licenses:
- android-sdk-preview-license-.+
- android-sdk-license-.+
- google-gdk-license-.+

cache:
  directories:
  - $HOME/.gradle/caches/
  - $HOME/.gradle/wrapper/

before_install:
- yes | sdkmanager "platforms;android-28"

stages:
- name: compile
#  if: branch =~ ^\d+\.\d+\.\d+$
- name: test
#  if: branch = master OR branch =~ ^\d+\.\d+\.\d+$
- name: deploy
#  if: branch =~ ^\d+\.\d+\.\d+$

jobs:
  include:
  - stage: compile
    script: ./gradlew clean assembleDebug -P"sygic.sdk.key"=$SYGIC_API_KEY
  - stage: test
    script: ./gradlew test #todo ./gradlew check # UI tests?
  - stage: deploy
    script: echo 'deploing job done' #todo

after_failure:
- cat $TRAVIS_BUILD_DIR/app/build/reports/lint-results.xml
